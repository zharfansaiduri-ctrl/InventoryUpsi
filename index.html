<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Permohonan Aset</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f2f2f2;padding:20px}
.box{max-width:450px;margin:auto;background:#fff;padding:20px;border-radius:8px}
input,select,button{width:100%;padding:8px;margin:6px 0}
button{background:#0d6efd;color:#fff;border:none}
#list{border:1px solid #ccc;list-style:none;padding:0;margin:0}
#list li{padding:6px;cursor:pointer}
#list li:hover{background:#eee}
.hide{display:none}
</style>
</head>

<body>
<div class="box">
<h3>Permohonan Aset</h3>

<form id="f">
  <input id="nama" placeholder="Nama Staff" autocomplete="off" required>
  <ul id="list"></ul>

  <input id="jabatan" placeholder="Jabatan" readonly required>

  <select id="jenis" required>
    <option value="">Pilih Aset</option>
    <option value="alat_tulis">Alat Tulis</option>
    <option value="kenderaan">Kenderaan</option>
    <option value="projektor">Projektor</option>
    <option value="kertas_a4">Kertas A4</option>
  </select>

  <input id="item" class="hide">
  <input id="tempoh" class="hide" placeholder="Tempoh">
  <input id="kuantiti" class="hide" type="number" placeholder="Kuantiti">

  <button>Hantar</button>
</form>

<p id="m"></p>
</div>

<script>
/* ===== API ===== */
const STAFF_API="https://script.google.com/macros/s/XXXX/exec";
const API={
 alat_tulis:"https://script.google.com/macros/s/XXXX/exec",
 kenderaan:"https://script.google.com/macros/s/XXXX/exec",
 projektor:"https://script.google.com/macros/s/XXXX/exec",
 kertas_a4:"https://script.google.com/macros/s/XXXX/exec"
};

/* ===== ELEMEN ===== */
const nama=nama;
const jabatan=jabatan;
const list=document.getElementById("list");
const jenis=jenis;
const item=item;
const tempoh=tempoh;
const kuantiti=kuantiti;
const f=f;
const m=m;

/* ===== AUTOCOMPLETE ===== */
nama.oninput=async()=>{
 list.innerHTML=""; jabatan.value="";
 if(nama.value.length<2)return;

 const r=await fetch(`${STAFF_API}?search=${nama.value}`);
 const d=await r.json();

 d.forEach(s=>{
  const li=document.createElement("li");
  li.textContent=s.Nama;
  li.onclick=()=>{
    nama.value=s.Nama;
    jabatan.value=s.Dept;
    list.innerHTML="";
  };
  list.appendChild(li);
 });
};

/* ===== FIELD ===== */
jenis.onchange=()=>{
 item.className="hide";
 tempoh.className="hide";
 kuantiti.className="hide";
 item.value=tempoh.value=kuantiti.value="";

 if(jenis.value=="alat_tulis"){
   item.placeholder="Jenis Alat";
   item.className="";
   kuantiti.className="";
 }
 if(jenis.value=="kenderaan"){
   item.placeholder="Jenis Kenderaan";
   item.className="";
   tempoh.className="";
 }
 if(jenis.value=="projektor"){
   item.placeholder="Bilangan Projektor";
   item.className="";
   tempoh.className="";
 }
 if(jenis.value=="kertas_a4"){
   kuantiti.className="";
 }
};

/* ===== SUBMIT ===== */
f.onsubmit=async(e)=>{
 e.preventDefault();
 if(!jabatan.value){m.innerText="Pilih nama dari senarai";return;}

 const p={
  Nama:nama.value,
  Jabatan:jabatan.value,
  Tarikh:new Date().toLocaleDateString("ms-MY")
 };

 if(jenis.value=="alat_tulis"){p.JenisAlat=item.value;p.Kuantiti=kuantiti.value;}
 if(jenis.value=="kenderaan"){p.JenisKenderaan=item.value;p.Tempoh=tempoh.value;}
 if(jenis.value=="projektor"){p.BilanganProjektor=item.value;p.Tempoh=tempoh.value;}
 if(jenis.value=="kertas_a4"){p.Kuantiti=kuantiti.value;}

 const r=await fetch(API[jenis.value],{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify(p)
 });

 const j=await r.json();
 m.innerText=j.message||"OK";
 f.reset();
};
</script>
</body>
</html>
