<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Portal - Kehadiran</title>
<link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #1A2350;
    --bg2: #1FA2FF;
    --card:#F4F6F8;
    --accent:#12D8FA;
    --muted:#6B7280;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'League Spartan',sans-serif;
    background: linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);
    min-height:100vh;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:20px;
  }
  .portal-box{
    width:100%;
    max-width:1000px;
    background:var(--card);
    padding:32px;
    border-radius:16px;
    box-shadow:0 12px 36px rgba(0,0,0,0.22);
    text-align:center;
  }
  h1{color:var(--bg1);margin-bottom:20px;}
  button.option{
    display:inline-block;
    width:180px;
    margin:10px 8px;
    padding:12px;
    border:none;
    border-radius:10px;
    font-size:16px;
    color:white;
    background: linear-gradient(135deg,var(--bg2) 0%,var(--accent) 100%);
    cursor:pointer;
    transition:all .2s ease;
  }
  button.option:hover{transform:translateY(-2px)}
  button.logout{
    margin-top:20px;
    background:#f87171;
    padding:12px 20px;
    cursor:pointer;
  }
  .table-container{
    margin-top:20px;
    overflow-x:auto;
  }
  table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
  }
  th,td{
    border:1px solid #ddd;
    padding:8px;
    text-align:left;
  }
  th{
    background:var(--bg1);
    color:white;
    position: sticky;
    top:0;
  }
  tr:nth-child(even){background:#f9f9f9;}
  .loading{
    text-align:center;
    color:var(--muted);
    padding:15px;
  }
  .search-box{
    margin-top:20px;
    text-align:right;
  }
  .search-box input{
    padding:6px 10px;
    font-size:14px;
    border-radius:6px;
    border:1px solid #ccc;
    width:200px;
  }
  .pagination{
    margin-top:15px;
    text-align:center;
  }
  .pagination button{
    padding:6px 10px;
    margin:2px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    background:#12D8FA;
    color:white;
    transition:0.2s;
  }
  .pagination button.active{
    background:#1A2350;
  }
</style>
</head>
<body>

<div class="portal-box">
  <h1>Admin Portal</h1>
  <div>
    <button class="option" onclick="loadSheet('kenderaan')">Kenderaan</button>
    <button class="option" onclick="loadSheet('alat_tulis')">Alat Tulis</button>
    <button class="option" onclick="loadSheet('projektor')">Projektor</button>
    <button class="option" onclick="loadSheet('kertas_a4')">Kertas A4</button>
  </div>
  <button class="logout" onclick="logout()">Log Keluar</button>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Cari data..." oninput="filterTable()">
  </div>

  <div id="tableContainer" class="table-container"></div>
  <div id="pagination" class="pagination"></div>
</div>

<script>
const RESPONSE_API = {
  alat_tulis: "https://script.google.com/macros/s/AKfycbzKHI_vjI5IcjvoFvSc-gGnv9f7AkrD4RiKc0_ldANOTh2bpqCoRAu9RxFcNxsN1Uh0/exec",
  kenderaan: "https://script.google.com/macros/s/AKfycbxZBQuiuH0Z82rR9gulJQZjQfB_lUEd_8zLunhsZS5i_MgAedhIBjXoQHlItnWIHLSKQA/exec",
  projektor: "https://script.google.com/macros/s/AKfycbwmiTbvX0dtdFuAayUvoQ3ySyYK0zF1hY-c2XMKEA-Vg3hr60TzCPXWym6l8UTzQJnF/exec",
  kertas_a4: "https://script.google.com/macros/s/AKfycbwqMcnwr_4OU1HrOrCS0oQdIl2GXWuSa46SqXfCN1uGks3m_9E8nevhRKMK2Ivx0Bzl/exec"
};

let allData = [];
let currentPage = 1;
const rowsPerPage = 10;
let headers = [];

if(sessionStorage.getItem('isLoggedIn') !== 'true'){
  window.location.href='adminlogin.html';
}

function loadSheet(type){
  const apiUrl = RESPONSE_API[type];
  const container = document.getElementById('tableContainer');
  container.innerHTML = `<div class="loading">Memuatkan data ${type}...</div>`;
  currentPage = 1;
  document.getElementById('searchInput').value = '';

  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      if(!Array.isArray(data) || data.length===0){
        container.innerHTML = `<div class="loading">Tiada data ditemui untuk ${type}.</div>`;
        document.getElementById('pagination').innerHTML = '';
        return;
      }

      allData = data;
      headers = Object.keys(data[0]);
      renderTable();
    })
    .catch(err => {
      container.innerHTML = `<div class="loading">Ralat memuatkan data: ${err}</div>`;
      console.error(err);
    });
}

function renderTable(){
  const container = document.getElementById('tableContainer');
  const paginationDiv = document.getElementById('pagination');
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();

  // filter data
  let filtered = allData.filter(row => {
    return headers.some(h => (row[h]+'').toLowerCase().includes(searchTerm));
  });

  const totalPages = Math.ceil(filtered.length / rowsPerPage);
  if(currentPage > totalPages) currentPage = 1;

  const start = (currentPage -1)*rowsPerPage;
  const end = start + rowsPerPage;
  const pageData = filtered.slice(start, end);

  if(pageData.length===0){
    container.innerHTML = `<div class="loading">Tiada data ditemui.</div>`;
    paginationDiv.innerHTML = '';
    return;
  }

  // bina table
  let html = `<table><thead><tr>`;
  headers.forEach(h => html += `<th>${h}</th>`);
  html += `</tr></thead><tbody>`;

  pageData.forEach(row => {
    html += `<tr>`;
    headers.forEach(h => html += `<td>${row[h]||'-'}</td>`);
    html += `</tr>`;
  });

  html += `</tbody></table>`;
  container.innerHTML = html;

  // pagination buttons
  let pagHtml = '';
  for(let i=1;i<=totalPages;i++){
    pagHtml += `<button class="${i===currentPage?'active':''}" onclick="gotoPage(${i})">${i}</button>`;
  }
  paginationDiv.innerHTML = pagHtml;
}

function gotoPage(page){
  currentPage = page;
  renderTable();
}

function filterTable(){
  currentPage = 1;
  renderTable();
}

function logout(){
  sessionStorage.removeItem('isLoggedIn');
  window.location.href='adminlogin.html';
}
</script>

</body>
</html>
